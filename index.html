<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui"
    />
  </head>
  <body>
    <div id="app">
      <v-app>
        <div class="d-flex justify-center mb-9">
          <p class="d-flex justify-center" >
            <h1 style="padding-top: 20px"> Lista de Contatos</h1>
          </p>
        </div>
        <div>
          <v-main>
            <div>
              <v-row justify="center" >
                <v-btn color="primary" dark @click.stop="dialog = true" > 
                  Adicionar
                </v-btn>
                <v-dialog
                  v-model="dialog"
                  slot="activator"
                  max-width="290"
                  ref="myModel"
                >
                  <v-card>
                    <v-card-title class="text-h5" v-if()>
                      Novo Contato
                    </v-card-title>
                    <v-card-text>
                      <v-text-field
                        label="Nome de Contato"
                        ref="name"
                        placeholder="ex..joão"
                        filled
                        rounded
                        dense
                        v-model="contact.name"
                        :rules="[
                        () => !!contact.name || 'Este campo é obrigatório',
                        (value) =>contact.name.split(' ').every(val => val.length >= 3) 
                        || 'Este campo deve ter mais de três letras'                      
                        ]"
                        required
                      ></v-text-field>
                      <v-text-field
                        v-mask="'(##)#####-####'"
                        ref="telephone"
                        label="Telefone"
                        id="telefone"
                        placeholder="ex..8899731"
                        filled
                        rounded
                        dense
                        v-model="contact.telephone"
                        :rules="[											
												() => !!contact.telephone || 'Este campo é obrigatório',
												() => !!contact.telephone && contact.telephone.length <= 15]"
                        :maxlength="max"
                        counter="15"
                        required
                      ></v-text-field>
                    </v-card-text>
                    <v-card-actions>
                      <v-spacer></v-spacer>
                      <v-btn
                        color="green darken-1"
                        text
                        @click="dialog = false"
                        typ
                      >
                        Sair
                      </v-btn>
                      <v-btn
                        color="green darken-1"
                        text
                        @click="add(), dialog = false"
                      >
                        Cadastrar
                      </v-btn>
                    </v-card-actions>
                  </v-card>
                </v-dialog>
              </v-row>
            </div>
            <div class="d-flex" style="padding-top: 20px">
              <table class="table" >
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Nome</th>
                    <th scope="col">Telefone</th>
                    <th scope="col">Ação</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="item in list">
                    <th scope="row">{{ item.id }}</th>
                    <td>{{ item.name }}</td>
                    <td>{{ item.telephone }}</td>
                    <td>
                      <button
                        @click="edit(item)"
                        @click.stop="dialog = true"
                        class="btn btn-info"
                      >
                        Editar
                      </button>
                      <button @click="remove()" class="btn btn-danger">
                        Excluir
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </v-main>
        </div>
      </v-app>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/v-mask/dist/v-mask.min.js"></script>

    <script>
      Vue.use(VueMask.VueMaskPlugin),
        new Vue({
          el: "#app",
          vuetify: new Vuetify(),
          data: {
            dialog: false,
            max: 15,
            ddd:11,
            contact: {
              id: null,
              name: null,
              telephone: null,
            },          
            index: null,
            list: [],
          },   
          watch:{
            ddd(oldDDD, newDDD){

            }
          },     
        mounted() {
            const contacts = JSON.parse(localStorage.getItem("contacts"));
            this.list = contacts ? contacts : [];
          },
          methods: {       
            add() {
              if (
                (this.contact.name === null) |
                (this.contact.telephone === null)
              ) {
                alert("error");
                return false;
              }
              if( this.contact.telephone  == "(11)"){
                console.log('deu certo')

              }
              if (this.contact.id === null) {
                this.contact.id = this.list.length + 1;
                this.list.push(this.contact);             
                localStorage.setItem("contacts", JSON.stringify(this.list));
                this.contact = { id: null, name: null, telephone: null };               
               
              } else {
                this.list[this.index] = this.contact;
              }    
                 
            },
            remove(item) {
              const idx = this.list.indexOf(item);
              this.list.splice(idx, 1);
              localStorage.setItem("contacts", JSON.stringify(this.list));
            },
            edit(item) {
              this.index = this.list.indexOf(item);
              this.contact = Object.assign({}, item);
              localStorage.setItem("contacts", JSON.stringify(this.list));
            } ,            
            DDD(item){     
              if( this.contact.telephone  === '(11)'){
               
                console.log('deu certo')
              }         
              else{
                console.log('deu errado')
              }
              
            }
          },
        });
    </script>
  </body>
</html>
